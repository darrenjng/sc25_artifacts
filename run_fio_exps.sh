#!/usr/bin/env bash

# device=/dev/sdb
# device=/dev/sdc
device=/dev/sda
# device=/dev/nvme0n1

# iopattern_arg1=("seq_write" "seq_read" "randwrite" "randread" "mixed_workload")
# iopattern_arg2=("write" "read" "randwrite" "randread" "randrw")
iopattern_arg1=("seq_write" "seq_read")
iopattern_arg2=("write" "read")

# block_size=(128k 128k 4k 4k 4k)
# iodepth=(32 32 16 16 16)
block_size=(64k)
# iodepth=(32 32)
# iodepth=(64 64)
# iodepth=(32 32 32 32 32 32)
iodepth=32

# runtime=60
# numjobs=(1 4 8 16 32 64) # I think this can be similar to number of queues (and iodepth would be queue depth assuming that direct=1 and ioengine is not default)
numjobs=1
# size=(1362397.82016349 1190476.19047619 1235788.43302027 1214771.62293489 1242544.73161034 1185395.92223803 1217730.15099854 1353546.29128316 1222493.88753056 1235177.86561265 1162790.69767442 1160092.80742459 1112099.64412811)
# size=(100000000 100000000 100000000 100000000 100000000 100000000 100000000 100000000 100000000 100000000 100000000 100000000 100000000)
# size=(805773 826327 6224345 46193044 46593174 62674766 6322289 47078281 886926 8141627 805680 53938150 805680 48897285 10422775 46227464 805773 49077208 913733 53422799)
# size=(18242 8396 1277560 33630719 32147514 45820125 5200920 31132960 29387 7346005 145 31856408 694 22070652 9055328 32880144 18204 27317656 37899 31925023)
# size=(2498056 1140976 10665664 58255120 55667272 68117568 31659912 53033240 1567248 35159752 673552 55414976 699480 39907960 42449712 57198608 1877536 49418176 3006424 55351592)
# size=(292778742 444752954 238272898 413358810 448973123 424579248)
# size=(162364415 479877088 86104834 466702212 347698848 472951677)
# size=(244182104 376439992 159474544 359332856 374011808 370221784)
# size=(208842 8690785 1896922 1412434 12635647 208842 13539100 8244088 11262206 9993788 1341830 17951458 359325 17120153 10863898 19511703 10854045 13451240 208842 12971615 13179503 14025714 1501641 13450469 6833257 12284718 208842 13072111 12971308 721336 208842 10962472 17444061 10562957 13017621 858669 8612144 1369332 10720953 5831842 347572 8612144 2464670 553270 1455095 11018824 8002575 6830760 13132837 7966948 12974644 3096792 15654721 12284414 208842 16054034 710651 1302785 11210659 208842 376170 13648070 12195434 13274913 8572317 13922849 12938308 208842 10909987 208842 10547132 5397575 17844528 14593649 3635230 15128599 208842 10441928 10930564)
# size=(136 2769973 849236 416148 7260400 136 7307540 2373810 5452832 3617664 740504 11576706 68215 12438926 4448440 13726564 4669949 6767904 136 7614306 5931005 7172182 470216 6766325 1660993 5441587 136 7577085 7574423 124119 136 5171671 10993141 5727212 7690513 142872 1432423 244132 3801961 1877210 61804 1432423 268788 97789 261881 4777254 2368165 1584552 6554142 2067792 7610468 353524 9633803 5455251 136 7561301 62037 492850 9366239 136 64361 6815402 5612724 6993895 2571963 7213758 6151096 136 5955265 136 5728129 846350 13243614 8299483 409944 9022289 136 4591841 4550610)
# size=(50632 8631024 4720920 1860480 12328080 50632 13745528 8038264 12864752 11695656 3797688 18665896 2225792 18338680 12444816 19849472 12509384 13671192 50632 12742720 14046416 14355848 2191192 13667416 7073024 13247216 50632 12953584 12677120 2428520 455464 12491688 18479488 11558288 12739288 2939600 8435504 3668112 11589328 6237120 1456192 8435504 4476784 2626864 3771760 12605768 8282320 6766752 13027000 7684400 12745584 4843848 16117232 13244680 50632 16994256 3470536 2006584 13784016 50632 1494376 13257336 12646616 13240352 8514376 13662440 13206120 50632 11864216 50632 11555312 6153480 18858232 14891616 5209904 15246776 50632 11355208 12410944)
# size=(5928925 5444408 5437091 20030220 17111950 8730506 19872337)
# size=(2628229 2075544 2069531 9053428 7826037 3063158 7792743)
# size=(8255960 6111672 6101728 24067936 22406144 8775960 22437784)
# size=( $(for i in {1..79}; do echo -n "25920000 "; done) )
size=( $(for i in {1..7}; do echo -n "301989888 "; done) )


for ((k=0; k < ${#size[@]}; k++))
do
	for ((j=0; j < ${#block_size[@]}; j++))
	do
		for ((i=0; i < ${#iopattern_arg1[@]}; i++))
		do
			echo "RUNNING: fio --name=${iopattern_arg1[i]} --rw=${iopattern_arg2[i]} --bs=${block_size[j]} --iodepth=$iodepth --size=${size[k]} --numjobs=$numjobs --direct=1 --filename=$device --group_reporting"
			sudo fio --name=${iopattern_arg1[i]} --rw=${iopattern_arg2[i]} --bs=${block_size[j]} --iodepth=$iodepth --size=${size[k]} --numjobs=$numjobs --direct=1 --filename=$device --group_reporting
			echo "COMPRESSED_SIZE: ${size[k]}"
		done
	done
done
